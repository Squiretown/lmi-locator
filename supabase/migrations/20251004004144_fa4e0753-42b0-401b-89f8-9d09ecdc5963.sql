-- Create county_fips_codes reference table
CREATE TABLE IF NOT EXISTS public.county_fips_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  state_code TEXT NOT NULL,
  county_code TEXT NOT NULL,
  county_name TEXT NOT NULL,
  state_abbr TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  CONSTRAINT unique_state_county UNIQUE (state_code, county_code)
);

-- Create index for fast lookups
CREATE INDEX IF NOT EXISTS idx_county_state_abbr ON public.county_fips_codes(state_abbr, county_name);

-- Enable RLS
ALTER TABLE public.county_fips_codes ENABLE ROW LEVEL SECURITY;

-- Create policy for public read access
CREATE POLICY "Public read access to county FIPS codes"
  ON public.county_fips_codes
  FOR SELECT
  USING (true);

-- Create policy for admin write access
CREATE POLICY "Admin write access to county FIPS codes"
  ON public.county_fips_codes
  FOR ALL
  USING (user_is_admin())
  WITH CHECK (user_is_admin());

-- Populate with US county FIPS codes (comprehensive list)
-- New York counties
INSERT INTO public.county_fips_codes (state_code, county_code, county_name, state_abbr) VALUES
('36', '001', 'Albany County', 'NY'),
('36', '003', 'Allegany County', 'NY'),
('36', '005', 'Bronx County', 'NY'),
('36', '007', 'Broome County', 'NY'),
('36', '009', 'Cattaraugus County', 'NY'),
('36', '011', 'Cayuga County', 'NY'),
('36', '013', 'Chautauqua County', 'NY'),
('36', '015', 'Chemung County', 'NY'),
('36', '017', 'Chenango County', 'NY'),
('36', '019', 'Clinton County', 'NY'),
('36', '021', 'Columbia County', 'NY'),
('36', '023', 'Cortland County', 'NY'),
('36', '025', 'Delaware County', 'NY'),
('36', '027', 'Dutchess County', 'NY'),
('36', '029', 'Erie County', 'NY'),
('36', '031', 'Essex County', 'NY'),
('36', '033', 'Franklin County', 'NY'),
('36', '035', 'Fulton County', 'NY'),
('36', '037', 'Genesee County', 'NY'),
('36', '039', 'Greene County', 'NY'),
('36', '041', 'Hamilton County', 'NY'),
('36', '043', 'Herkimer County', 'NY'),
('36', '045', 'Jefferson County', 'NY'),
('36', '047', 'Kings County', 'NY'),
('36', '049', 'Lewis County', 'NY'),
('36', '051', 'Livingston County', 'NY'),
('36', '053', 'Madison County', 'NY'),
('36', '055', 'Monroe County', 'NY'),
('36', '057', 'Montgomery County', 'NY'),
('36', '059', 'Nassau County', 'NY'),
('36', '061', 'New York County', 'NY'),
('36', '063', 'Niagara County', 'NY'),
('36', '065', 'Oneida County', 'NY'),
('36', '067', 'Onondaga County', 'NY'),
('36', '069', 'Ontario County', 'NY'),
('36', '071', 'Orange County', 'NY'),
('36', '073', 'Orleans County', 'NY'),
('36', '075', 'Oswego County', 'NY'),
('36', '077', 'Otsego County', 'NY'),
('36', '079', 'Putnam County', 'NY'),
('36', '081', 'Queens County', 'NY'),
('36', '083', 'Rensselaer County', 'NY'),
('36', '085', 'Richmond County', 'NY'),
('36', '087', 'Rockland County', 'NY'),
('36', '089', 'St. Lawrence County', 'NY'),
('36', '091', 'Saratoga County', 'NY'),
('36', '093', 'Schenectady County', 'NY'),
('36', '095', 'Schoharie County', 'NY'),
('36', '097', 'Schuyler County', 'NY'),
('36', '099', 'Seneca County', 'NY'),
('36', '101', 'Steuben County', 'NY'),
('36', '103', 'Suffolk County', 'NY'),
('36', '105', 'Sullivan County', 'NY'),
('36', '107', 'Tioga County', 'NY'),
('36', '109', 'Tompkins County', 'NY'),
('36', '111', 'Ulster County', 'NY'),
('36', '113', 'Warren County', 'NY'),
('36', '115', 'Washington County', 'NY'),
('36', '117', 'Wayne County', 'NY'),
('36', '119', 'Westchester County', 'NY'),
('36', '121', 'Wyoming County', 'NY'),
('36', '123', 'Yates County', 'NY')
ON CONFLICT (state_code, county_code) DO NOTHING;

-- Texas counties (sample - 254 total, showing first 50)
INSERT INTO public.county_fips_codes (state_code, county_code, county_name, state_abbr) VALUES
('48', '001', 'Anderson County', 'TX'),
('48', '003', 'Andrews County', 'TX'),
('48', '005', 'Angelina County', 'TX'),
('48', '007', 'Aransas County', 'TX'),
('48', '009', 'Archer County', 'TX'),
('48', '011', 'Armstrong County', 'TX'),
('48', '013', 'Atascosa County', 'TX'),
('48', '015', 'Austin County', 'TX'),
('48', '017', 'Bailey County', 'TX'),
('48', '019', 'Bandera County', 'TX'),
('48', '021', 'Bastrop County', 'TX'),
('48', '023', 'Baylor County', 'TX'),
('48', '025', 'Bee County', 'TX'),
('48', '027', 'Bell County', 'TX'),
('48', '029', 'Bexar County', 'TX'),
('48', '031', 'Blanco County', 'TX'),
('48', '033', 'Borden County', 'TX'),
('48', '035', 'Bosque County', 'TX'),
('48', '037', 'Bowie County', 'TX'),
('48', '039', 'Brazoria County', 'TX'),
('48', '041', 'Brazos County', 'TX'),
('48', '043', 'Brewster County', 'TX'),
('48', '045', 'Briscoe County', 'TX'),
('48', '047', 'Brooks County', 'TX'),
('48', '049', 'Brown County', 'TX'),
('48', '051', 'Burleson County', 'TX'),
('48', '053', 'Burnet County', 'TX'),
('48', '055', 'Caldwell County', 'TX'),
('48', '057', 'Calhoun County', 'TX'),
('48', '059', 'Callahan County', 'TX'),
('48', '061', 'Cameron County', 'TX'),
('48', '063', 'Camp County', 'TX'),
('48', '065', 'Carson County', 'TX'),
('48', '067', 'Cass County', 'TX'),
('48', '069', 'Castro County', 'TX'),
('48', '071', 'Chambers County', 'TX'),
('48', '073', 'Cherokee County', 'TX'),
('48', '075', 'Childress County', 'TX'),
('48', '077', 'Clay County', 'TX'),
('48', '079', 'Cochran County', 'TX'),
('48', '081', 'Coke County', 'TX'),
('48', '083', 'Coleman County', 'TX'),
('48', '085', 'Collin County', 'TX'),
('48', '087', 'Collingsworth County', 'TX'),
('48', '089', 'Colorado County', 'TX'),
('48', '091', 'Comal County', 'TX'),
('48', '093', 'Comanche County', 'TX'),
('48', '095', 'Concho County', 'TX'),
('48', '097', 'Cooke County', 'TX'),
('48', '099', 'Coryell County', 'TX')
ON CONFLICT (state_code, county_code) DO NOTHING;

-- California counties
INSERT INTO public.county_fips_codes (state_code, county_code, county_name, state_abbr) VALUES
('06', '001', 'Alameda County', 'CA'),
('06', '003', 'Alpine County', 'CA'),
('06', '005', 'Amador County', 'CA'),
('06', '007', 'Butte County', 'CA'),
('06', '009', 'Calaveras County', 'CA'),
('06', '011', 'Colusa County', 'CA'),
('06', '013', 'Contra Costa County', 'CA'),
('06', '015', 'Del Norte County', 'CA'),
('06', '017', 'El Dorado County', 'CA'),
('06', '019', 'Fresno County', 'CA'),
('06', '021', 'Glenn County', 'CA'),
('06', '023', 'Humboldt County', 'CA'),
('06', '025', 'Imperial County', 'CA'),
('06', '027', 'Inyo County', 'CA'),
('06', '029', 'Kern County', 'CA'),
('06', '031', 'Kings County', 'CA'),
('06', '033', 'Lake County', 'CA'),
('06', '035', 'Lassen County', 'CA'),
('06', '037', 'Los Angeles County', 'CA'),
('06', '039', 'Madera County', 'CA'),
('06', '041', 'Marin County', 'CA'),
('06', '043', 'Mariposa County', 'CA'),
('06', '045', 'Mendocino County', 'CA'),
('06', '047', 'Merced County', 'CA'),
('06', '049', 'Modoc County', 'CA'),
('06', '051', 'Mono County', 'CA'),
('06', '053', 'Monterey County', 'CA'),
('06', '055', 'Napa County', 'CA'),
('06', '057', 'Nevada County', 'CA'),
('06', '059', 'Orange County', 'CA'),
('06', '061', 'Placer County', 'CA'),
('06', '063', 'Plumas County', 'CA'),
('06', '065', 'Riverside County', 'CA'),
('06', '067', 'Sacramento County', 'CA'),
('06', '069', 'San Benito County', 'CA'),
('06', '071', 'San Bernardino County', 'CA'),
('06', '073', 'San Diego County', 'CA'),
('06', '075', 'San Francisco County', 'CA'),
('06', '077', 'San Joaquin County', 'CA'),
('06', '079', 'San Luis Obispo County', 'CA'),
('06', '081', 'San Mateo County', 'CA'),
('06', '083', 'Santa Barbara County', 'CA'),
('06', '085', 'Santa Clara County', 'CA'),
('06', '087', 'Santa Cruz County', 'CA'),
('06', '089', 'Shasta County', 'CA'),
('06', '091', 'Sierra County', 'CA'),
('06', '093', 'Siskiyou County', 'CA'),
('06', '095', 'Solano County', 'CA'),
('06', '097', 'Sonoma County', 'CA'),
('06', '099', 'Stanislaus County', 'CA'),
('06', '101', 'Sutter County', 'CA'),
('06', '103', 'Tehama County', 'CA'),
('06', '105', 'Trinity County', 'CA'),
('06', '107', 'Tulare County', 'CA'),
('06', '109', 'Tuolumne County', 'CA'),
('06', '111', 'Ventura County', 'CA'),
('06', '113', 'Yolo County', 'CA'),
('06', '115', 'Yuba County', 'CA')
ON CONFLICT (state_code, county_code) DO NOTHING;

-- Florida counties
INSERT INTO public.county_fips_codes (state_code, county_code, county_name, state_abbr) VALUES
('12', '001', 'Alachua County', 'FL'),
('12', '003', 'Baker County', 'FL'),
('12', '005', 'Bay County', 'FL'),
('12', '007', 'Bradford County', 'FL'),
('12', '009', 'Brevard County', 'FL'),
('12', '011', 'Broward County', 'FL'),
('12', '013', 'Calhoun County', 'FL'),
('12', '015', 'Charlotte County', 'FL'),
('12', '017', 'Citrus County', 'FL'),
('12', '019', 'Clay County', 'FL'),
('12', '021', 'Collier County', 'FL'),
('12', '023', 'Columbia County', 'FL'),
('12', '027', 'DeSoto County', 'FL'),
('12', '029', 'Dixie County', 'FL'),
('12', '031', 'Duval County', 'FL'),
('12', '033', 'Escambia County', 'FL'),
('12', '035', 'Flagler County', 'FL'),
('12', '037', 'Franklin County', 'FL'),
('12', '039', 'Gadsden County', 'FL'),
('12', '041', 'Gilchrist County', 'FL'),
('12', '043', 'Glades County', 'FL'),
('12', '045', 'Gulf County', 'FL'),
('12', '047', 'Hamilton County', 'FL'),
('12', '049', 'Hardee County', 'FL'),
('12', '051', 'Hendry County', 'FL'),
('12', '053', 'Hernando County', 'FL'),
('12', '055', 'Highlands County', 'FL'),
('12', '057', 'Hillsborough County', 'FL'),
('12', '059', 'Holmes County', 'FL'),
('12', '061', 'Indian River County', 'FL'),
('12', '063', 'Jackson County', 'FL'),
('12', '065', 'Jefferson County', 'FL'),
('12', '067', 'Lafayette County', 'FL'),
('12', '069', 'Lake County', 'FL'),
('12', '071', 'Lee County', 'FL'),
('12', '073', 'Leon County', 'FL'),
('12', '075', 'Levy County', 'FL'),
('12', '077', 'Liberty County', 'FL'),
('12', '079', 'Madison County', 'FL'),
('12', '081', 'Manatee County', 'FL'),
('12', '083', 'Marion County', 'FL'),
('12', '085', 'Martin County', 'FL'),
('12', '086', 'Miami-Dade County', 'FL'),
('12', '087', 'Monroe County', 'FL'),
('12', '089', 'Nassau County', 'FL'),
('12', '091', 'Okaloosa County', 'FL'),
('12', '093', 'Okeechobee County', 'FL'),
('12', '095', 'Orange County', 'FL'),
('12', '097', 'Osceola County', 'FL'),
('12', '099', 'Palm Beach County', 'FL'),
('12', '101', 'Pasco County', 'FL'),
('12', '103', 'Pinellas County', 'FL'),
('12', '105', 'Polk County', 'FL'),
('12', '107', 'Putnam County', 'FL'),
('12', '109', 'St. Johns County', 'FL'),
('12', '111', 'St. Lucie County', 'FL'),
('12', '113', 'Santa Rosa County', 'FL'),
('12', '115', 'Sarasota County', 'FL'),
('12', '117', 'Seminole County', 'FL'),
('12', '119', 'Sumter County', 'FL'),
('12', '121', 'Suwannee County', 'FL'),
('12', '123', 'Taylor County', 'FL'),
('12', '125', 'Union County', 'FL'),
('12', '127', 'Volusia County', 'FL'),
('12', '129', 'Wakulla County', 'FL'),
('12', '131', 'Walton County', 'FL'),
('12', '133', 'Washington County', 'FL')
ON CONFLICT (state_code, county_code) DO NOTHING;

-- Note: Due to message length constraints, this includes a representative sample of counties.
-- A complete production implementation should include all 3,143+ US counties across all 50 states + DC.
-- The table structure supports adding the remaining counties via additional INSERT statements.